{% extends 'orders/base.html' %}

{% block title %}Edytuj Zlecenie{% endblock %}

{% block content %}
<h2>Edytuj Zlecenie</h2>
<form method="post" enctype="multipart/form-data" class="form-container">
    {% csrf_token %}
    <table class="table">
        {% for field in form %}
        <tr class="form-group">
            {% if field.name in booleanFields %}
            <td>
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
            </td>
            <td>
                {{ field }}
            </td>
            <td>
                <input type="text" class="form-control" id="id_{{ field.name }}_price" style="display: none;">
            </td>
            {% else %}
            <td colspan="3">
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                {{ field }}
            </td>
            {% endif %}
            {% if field.help_text %}
            <td colspan="3">
                <small class="form-text text-muted">{{ field.help_text }}</small>
            </td>
            {% endif %}
            {% for error in field.errors %}
            <td colspan="3">
                <div class="text-danger">{{ error }}</div>
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
    <div class="form-group">
        <label for="total_cost">Suma koszt√≥w:</label>
        <input type="text" class="form-control" id="total_cost" readonly>
    </div>
    <button type="submit" class="btn btn-primary">Zapisz zmiany</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const booleanFields = ['border', 'frame', 'main_plate', 'lamp', 'vase', 'ball', 'covering'];
    const priceFields = ['border_price', 'frame_price', 'main_plate_price', 'lamp_price', 'vase_price', 'ball_price', 'covering_price', 'curbs_price', 'monument_cost', 'old_monument_removal', 'cemetery_fee', 'transport_cost', 'other_costs_price'];
    
    function calculateTotalCost() {
        let totalCost = 0;
        priceFields.forEach(field => {
            const priceField = document.querySelector(`#id_${field}`);
            if (priceField && priceField.value) {
                totalCost += parseFloat(priceField.value) || 0;
            }
        });
        document.querySelector('#total_cost').value = totalCost.toFixed(2);
    }

    booleanFields.forEach(field => {
        const checkbox = document.querySelector(`#id_${field}`);
        const priceField = document.querySelector(`#id_${field}_price`);
        if (checkbox && priceField) {
            priceField.style.display = checkbox.checked ? 'block' : 'none';
            checkbox.addEventListener('change', function() {
                priceField.style.display = checkbox.checked ? 'block' : 'none';
                calculateTotalCost();
            });
        }
    });

    priceFields.forEach(field => {
        const priceField = document.querySelector(`#id_${field}`);
        if (priceField) {
            priceField.addEventListener('input', calculateTotalCost);
        }
    });

    calculateTotalCost();
});
</script>
{% endblock %}